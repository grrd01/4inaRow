/**
 * grrd's 4 in a Row
 * Copyright (c) 2012 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};let e,t,n,o=function(e){return document.getElementById(e)},a=!1,i=!1;const l=["col0","col1","col2","col3","col4","col5","col6"];let s=[],r=[],c=[];for(e=0;e<6;e+=1)c[e]=[],c[e][6]=void 0;let A,d,m,g,u,f,p,h,w=[],y=[],L=null,b=!0,E=!1,I=!1;const v=o("game"),_=o("title"),k=o("popupInfo"),B=o("popupStats"),S=o("popupSettings"),T=o("popupCountry"),M=o("popupOnline"),Q=o("sp_country"),O=o("inputImage"),x=o("inputName"),D=o("b_sound"),P=o("l_country"),N=o("txt_search"),R=o("P1country"),C=o("P2country");let U,H=[],F=[];const G=["#ff0080","#6969EE"],q=["#D6016B","#5A5ACE"],z=["#FD6BB4","#9393EF"];let j=0;const W=["Images/red_on.png","Images/red_off.png"],Y=["Images/blue_on.png","Images/blue_off.png"];let K,X,Z,V,J,$,ee,te,ne,oe,ae,ie,le,se,re,ce,Ae,de,me,ge,ue,fe,pe,he,we,ye,Le=0,be=[0,0],Ee=Boolean(!1),Ie=null,ve=0,_e=!1,ke=!1,Be=function(){const e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();function Se(e){e!==k&&e!==B&&e!==S&&e!==M||(document.getElementsByTagName("FIELDSET")[0].disabled=!0),e===T&&(S.getElementsByTagName("FIELDSET")[0].disabled=!0),e!==o("popupDialog")&&e!==o("popupLeft")||(Array.from(v.getElementsByTagName("canvas")).forEach(e=>{e.tabIndex=-1}),v.getElementsByTagName("FIELDSET")[0].disabled=!0),e.classList.remove("popup-init"),e.classList.remove("popup-hide"),e.classList.add("popup-show"),document.activeElement.blur()}function Te(e){e!==k&&e!==B&&e!==S&&e!==M||(document.getElementsByTagName("FIELDSET")[0].disabled=!1),e===T&&(S.getElementsByTagName("FIELDSET")[0].disabled=!1),e!==o("popupDialog")&&e!==o("popupLeft")||(Array.from(v.getElementsByTagName("canvas")).forEach(e=>{e.tabIndex=0}),v.getElementsByTagName("FIELDSET")[0].disabled=!1),e.classList.remove("popup-show"),e.classList.add("popup-hide"),setTimeout((function(){e.scrollTop=0}),1050),document.activeElement.blur()}function Me(e,t,n,o){r[t].beginPath(),r[t].arc(oe/2,e,oe/2*.85,0,2*Math.PI,!1),r[t].fillStyle=n,r[t].fill(),r[t].lineWidth=oe/20,r[t].strokeStyle=o,r[t].stroke()}function Qe(){let e,o,a;for(t=document.documentElement.clientHeight,n=document.documentElement.clientWidth,t>n?(oe=Math.min((n-50)/7,(t-140)/6),ae=Math.max(6*oe*.85,t-190)):(oe=Math.min((n-140-60)/7,(t-20)/6),ae=Math.max(6*oe*.85,t-95)),e=0;e<l.length;e+=1)document.getElementById(l[e]).width=oe,document.getElementById(l[e]).height=ae;for(o=0;o<c[0].length&&void 0!==r[o];o+=1)for(e=0;e<c.length;e+=1)a=r[o].createLinearGradient(0,.9*(c.length-e-1)*oe,.7*oe,.9*(c.length-e-1)*oe+.7*oe),a.addColorStop(0,"black"),a.addColorStop(1,"grey"),r[o].beginPath(),r[o].arc(oe/2,(c.length-e-.5)*oe*.85,oe/2*.7,0,2*Math.PI,!1),r[o].lineWidth=oe/10,r[o].strokeStyle=a,r[o].stroke();for(o=0;o<c[0].length&&void 0!==r[o];o+=1){for(r[o].save(),r[o].beginPath(),e=0;e<c.length;e+=1)r[o].arc(oe/2,(c.length-e-.5)*oe*.85,oe/2*.7,0,2*Math.PI,!1);r[o].clip(),r[o].clearRect(0,0,oe,ae)}for(e=0;e<c.length;e+=1)for(o=0;o<c[e].length;o+=1)void 0!==c[e][o]&&Me((c.length-e-.5)*oe*.85,o,G[c[e][o]],q[c[e][o]]);i&&(ne=ne/te*((c.length-X-.5)*oe*.85),te=(c.length-X-.5)*oe*.85)}function Oe(){let e,t;for(ve=0,Ie=null,e=0;e<c.length;e+=1)for(t=0;t<c[e].length;t+=1)c[e][t]=void 0,0===e&&r[t].clearRect(0,0,oe,ae);Qe()}function xe(){o("P1light").src=W[j],o("P2light").src=Y[1-j]}function De(){let e,t;Be?(e=parseInt(localStorage.getItem(L+"_win")||0),t=parseInt(localStorage.getItem(L+"_loose")||0)):(e=0,t=0),"online"===L?(ie=Math.max(e+t,ue+fe,1),o("P"+(1+parseInt(he.role))+"win").style.width=100/ie*e+"%",o("P"+(1+parseInt(he.role))+"loose").style.width=100/ie*t+"%",o("P"+(2-parseInt(he.role))+"win").style.width=100/ie*ue+"%",o("P"+(2-parseInt(he.role))+"loose").style.width=100/ie*fe+"%"):("2player"===L&&(e=be[0],t=be[1]),ie=Math.max(e+t,1),o("P1win").style.width=100/ie*e+"%",o("P1loose").style.width=100/ie*t+"%",o("P2win").style.width=100/ie*t+"%",o("P2loose").style.width=100/ie*e+"%")}function Pe(e){let t,n;Be&&(L&&e&&(t=L+"_"+e,n=parseInt(localStorage.getItem(t)||0)+1,localStorage.setItem(t,n)),re=localStorage.getItem("easy_win")||0,ce=localStorage.getItem("easy_loose")||0,Ae=localStorage.getItem("medium_win")||0,de=localStorage.getItem("medium_loose")||0,me=localStorage.getItem("hard_win")||0,ge=localStorage.getItem("hard_loose")||0,le=localStorage.getItem("online_win")||0,se=localStorage.getItem("online_loose")||0,ie=Math.max(re,ce,Ae,de,me,ge,le,se,1),document.getElementById("easy_win").innerHTML=document.webL10n.get("lb_won")+" "+re,document.getElementById("easy_loose").innerHTML=document.webL10n.get("lb_lost")+" "+ce,document.getElementById("medium_win").innerHTML=document.webL10n.get("lb_won")+" "+Ae,document.getElementById("medium_loose").innerHTML=document.webL10n.get("lb_lost")+" "+de,document.getElementById("hard_win").innerHTML=document.webL10n.get("lb_won")+" "+me,document.getElementById("hard_loose").innerHTML=document.webL10n.get("lb_lost")+" "+ge,document.getElementById("online_win").innerHTML=document.webL10n.get("lb_won")+" "+le,document.getElementById("online_loose").innerHTML=document.webL10n.get("lb_lost")+" "+se,document.getElementById("easy_win").style.width=100/ie*re+"%",document.getElementById("easy_loose").style.width=100/ie*ce+"%",document.getElementById("medium_win").style.width=100/ie*Ae+"%",document.getElementById("medium_loose").style.width=100/ie*de+"%",document.getElementById("hard_win").style.width=100/ie*me+"%",document.getElementById("hard_loose").style.width=100/ie*ge+"%",document.getElementById("online_win").style.width=100/ie*le+"%",document.getElementById("online_loose").style.width=100/ie*se+"%")}function Ne(e){e.classList.remove("_African_Union","_Arab_League","_ASEAN","_CARICOM","_CIS","_Commonwealth","_England","_European_Union","_Islamic_Conference","_Kosovo","_NATO","_Northern_Cyprus","_Northern_Ireland","_Olimpic_Movement","_OPEC","_Red_Cross","_Scotland","_Somaliland","_Tibet","_United_Nations","_Wales","ad","ae","af","ag","ai","al","am","an","ao","aq","ar","as","at","au","aw","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bw","by","bz","ca","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cu","cv","cy","cz","de","dj","dk","dm","do","dz","ec","ee","eg","eh","er","es","et","fi","fj","fm","fo","fr","ga","gb","gd","ge","gg","gh","gi","gl","gm","gn","gp","gq","gr","gt","gu","gw","gy","hk","hn","hr","ht","hu","id","mc","ie","il","im","in","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","md","me","mg","mh","mk","ml","mm","mn","mo","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","ng","ni","nl","no","np","nr","nz","om","pa","pe","pf","pg","ph","pk","pl","pr","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","si","sk","sl","sm","sn","so","sr","st","sv","sy","sz","tc","td","tg","th","tj","tl","tm","tn","to","tr","tt","tv","tw","tz","ua","ug","us","uy","uz","va","vc","ve","vg","vi","vn","vu","ws","ye","za","zm","zw")}function Re(e,t){_e||(t+2e3>Date.now()&&i?window.requestAnimFrame((function(){Re(e,t)})):(Le+=1,o("printMessage").innerHTML=e,o("printGames").innerHTML=1===Le?Le+" "+document.webL10n.get("lb_game"):Le+" "+document.webL10n.get("lb_games"),o("printScore1a").innerHTML=p,o("printScore2a").innerHTML=h,o("printScore1b").innerHTML=be[0],o("printScore2b").innerHTML=be[1],Se(o("popupDialog")),i=!1))}function Ce(){i=!0,function e(t,n,o,a){let l;if(!_e)if(o<6&&a+250<Date.now()&&i){for(o+=1,a=Date.now(),l=0;l<4;l+=1)Me((c.length-t[l]-.5)*oe*.85,n[l],o%2!=0?z[j]:G[j],"white");window.requestAnimFrame((function(){e(t,n,o,a)}))}else o<6&&i&&window.requestAnimFrame((function(){e(t,n,o,a)}))}(w.slice(),y.slice(),0,Date.now())}function Ue(e,t,n,o,a,i){let l;if(e+3*n<c.length&&t+3*o<c[e].length&&e+3*n>=0&&t+3*o>=0)for(l=0;l<4;l+=1)c[e+l*n][t+l*o]===a?(w[l]=e+l*n,y[l]=t+l*o,3===l&&(J=!0,i&&Ce(),l=5)):l=5}function He(e,t){for(J=!1,X=0;X<c.length;X+=1)for(K=0;K<c[X].length;K+=1)Ue(X,K,1,0,e,t),Ue(X,K,0,1,e,t),Ue(X,K,1,1,e,t),Ue(X,K,1,-1,e,t);for($=!1,K=0;K<c[0].length;K+=1)void 0===c[c.length-1][K]&&($=!0)}function Fe(e,t,n){let o,a,l,s;i&&(o=new Date,a=o.getTime(),l=a-e,s=ae*l/1e3,t<te?(t=Math.min(te,t+s),e=a,r[n].clearRect(0,0,oe,te+oe/2*.85),Me(t,n,G[j],q[j]),window.requestAnimFrame((function(){Fe(e,t,n)}))):(b&&document.getElementById("click_sound").play(),i=!1,He(j,!0),J?(be[j]=be[j]+1,"easy"!==L&&"medium"!==L&&"hard"!==L||Pe(0===j?"win":"loose"),"online"===L&&(0===j&&"0"===he.role||1===j&&"1"===he.role?(fe+=1,Pe("win")):(ue+=1,Pe("loose"))),De(),b&&document.getElementById("ding_sound").play(),Re(0===j?p+" "+document.webL10n.get("lb_win"):h+" "+document.webL10n.get("lb_win"),Date.now())):$?(j=1-j,xe(),"2player"!==L&&"online"!==L&&1===j&&Ze()):(Pe("draw"),Re(document.webL10n.get("lb_draw"),Date.now()))))}function Ge(e){let t,n;if(!(ke&&(ke=!1,"online"===L&&(0===j&&"0"===he.role||1===j&&"1"===he.role))||i))for(ve+=1,X=0,te=0;X<c.length&&0===te;){if(void 0===c[X][e]){i=!0,c[X][e]=j,te=(c.length-X-.5)*oe*.85,t=new Date,n=t.getTime(),ne=-30,Fe(n,ne,e);break}X+=1}}function qe(){o("P1icon").src=E?O.src:"Images/player.svg",p=I?x.value:document.webL10n.get("lb_player"),Ne(R),u&&R.classList.add(u.split(" ")[1]),h=document.webL10n.get("lb_computer"),o("P1name").innerHTML=p,o("P2name").innerHTML=h,o("P2icon").src="Images/computer.svg",Ne(C),De(),xe(),_e=!1,_.classList.remove("swipe-out-right"),v.classList.remove("swipe-in-left"),_.classList.add("swipe-out"),v.classList.add("swipe-in")}function ze(){"online"===L&&(pe.disconnect(),o("bt_online").disabled=!1),_e=!0,Qe(),i=!1,Oe(),Le=0,j=0,be=[0,0],L=null,_.classList.remove("swipe-out"),v.classList.remove("swipe-in"),_.classList.add("swipe-out-right"),v.classList.add("swipe-in-left"),Te(o("popupDialog")),Te(o("popupLeft"))}function je(e){let t=0,n=0;for(;t<c.length&&0===n;)void 0===c[t][e]&&(n=(c.length-t-.5)*oe*.85,r[e].fillStyle="rgba(255,255,255,0.1)",r[e].beginPath(),r[e].fillRect(0,0,oe,n+oe/2*.85),r[e].stroke()),t+=1}function We(e){let t=0,n=0;for(;t<c.length&&0===n;)void 0===c[t][e]&&(n=(c.length-t-.5)*oe*.85,r[e].clearRect(0,0,oe,n+oe/2*.85)),t+=1}function Ye(e){"online"===L?1===j&&"0"===he.role||0===j&&"1"===he.role||(pe.emit("playsend",{to:he.opponent,col:e,round:ve}),Ge(e)):Ge(e)}function Ke(e,t,n){let o,a;for(A=0,d=0,m=0,o=n-3;o<=n;o+=1)if(o>=0&&o+3<c[0].length){for(Ee=!0,g=0,a=0;a<=3;a+=1)void 0!==c[t][o+a]&&(c[t][o+a]===e?g+=1:Ee=!1);Ee&&(A+=1,d+=g,g>m&&(m=g))}for(o=t+3;o>=t;o-=1)if(o-3>=0&&o<c.length){for(Ee=!0,g=0,a=0;a<=3;a+=1)void 0!==c[o-a][n]&&(c[o-a][n]===e?g+=1:Ee=!1);Ee&&(A+=1,d+=g,g>m&&(m=g))}for(o=3;o>=0;o-=1)if(n-o>=0&&n-o+3<c[0].length&&t-o>=0&&t-o+3<c.length){for(Ee=!0,g=0,a=0;a<=3;a+=1)void 0!==c[t-o+a][n-o+a]&&(c[t-o+a][n-o+a]===e?g+=1:Ee=!1);Ee&&(A+=1,d+=g,g>m&&(m=g))}for(o=3;o>=0;o-=1)if(n-o>=0&&n-o+3<c[0].length&&t+o<c.length&&t+o-3>=0){for(Ee=!0,g=0,a=0;a<=3;a+=1)void 0!==c[t+o-a][n-o+a]&&(c[t+o-a][n-o+a]===e?g+=1:Ee=!1);Ee&&(A+=1,d+=g,g>m&&(m=g))}}function Xe(e,t){return e-t}function Ze(){let e;for(H=[],ee=!1,Z=0;Z<c[0].length;Z+=1)for(H[Z]=0,V=0;V<c.length;V+=1)if(void 0===c[V][Z]){c[V][Z]=j,Ke(j,V,Z),H[Z]=1e4*m+100*A+d+2,c[V][Z]=void 0;break}for(F[0]=0,e=0;e<H.length;e+=1)H[e]>F[0]&&(F[0]=H[e]);for(j=1-j,Z=0;Z<c[0].length;Z+=1)for(V=0;V<c.length;V+=1)if(void 0===c[V][Z]){c[V][Z]=j,Ke(j,V,Z),1e4*m+100*A+d+2>F[0]&&(H[Z]=1e4*m+100*A+d+2),c[V][Z]=void 0;break}for(j=1-j,j=1-j,Z=0;Z<c[0].length;Z+=1){for(V=0;V<c.length-1;V+=1)if(void 0===c[V][Z]){c[V+1][Z]=j,He(j,!1),c[V+1][Z]=void 0;break}J&&(H[Z]=1,J=!1)}for(j=1-j,j=1-j,Z=0;Z<c[0].length;Z+=1){for(V=0;V<c.length;V+=1)if(void 0===c[V][Z]){c[V][Z]=j,He(j,!1),c[V][Z]=void 0;break}J&&(H[Z]=5e4,J=!1)}for(j=1-j,Z=0;Z<c[0].length;Z+=1){for(V=0;V<c.length;V+=1)if(void 0===c[V][Z]){c[V][Z]=j,He(j,!1),c[V][Z]=void 0;break}J&&(H[Z]=6e4,J=!1)}if(F=H.slice(),F.sort(Xe),F.reverse(),K=Math.round(6*Math.random()),"hard"===L)for(;H[K]!==F[0];)K=Math.round(6*Math.random());if("medium"===L)for(;H[K]<F[1]||0===H[K];)K=Math.round(6*Math.random());if("easy"===L)for(;H[K]<F[2]||0===H[K];)K=Math.round(6*Math.random());Ge(K)}function Ve(){Oe(),j=Le%2!=0?1:0,xe()}"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("sw.js").then((function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}),(function(e){console.log("ServiceWorker registration failed: ",e)}))})),navigator.onLine&&"undefined"!=typeof io||(o("bt_online").disabled=!0);const Je=new Promise((e,t)=>{const n=new Image;n.onload=()=>{e(1===n.naturalWidth)},n.onerror=t,n.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z"});function $e(e){let t=new FileReader,n=document.createElement("canvas"),o=null,a=new Image,i=67,l=71,s={Orientation:void 0};n.id="hiddenCanvas",n.width=i,n.height=l,n.style.visibility="hidden",document.body.appendChild(n),o=n.getContext("2d"),e.target.files[0].type.match("image.*")?t.readAsDataURL(e.target.files[0]):alert("File is not an image"),t.onload=function(){let t=this.result;EXIF.getData(e.target.files[0],(function(){s.Orientation=EXIF.getTag(this,"Orientation"),a.src=t}))},a.onload=function(){let e=0,t=0;0===this.width||0===this.height?alert("Image is empty"):(Je||(5!==s.Orientation&&6!==s.Orientation||(o.rotate(90*Math.PI/180),t=-1*i,i=71,l=67),3!==s.Orientation&&4!==s.Orientation||(o.rotate(180*Math.PI/180),t=-1*i-4,e=-1*l+4),7!==s.Orientation&&8!==s.Orientation||(o.rotate(270*Math.PI/180),e=-1*l,i=71,l=67)),o.clearRect(0,0,i,l),o.drawImage(a,0,0,this.width,this.height,e,t,i,l),O.src=n.toDataURL("image/jpeg"),Be&&localStorage.setItem("s_image",n.toDataURL("image/jpeg")),E=!0)}}function et(e){Array.from(P.getElementsByTagName("A")).forEach((function(t){t.innerHTML.toLowerCase().indexOf(e)>-1||0===e.length?t.style.display="block":t.style.display="none"}))}document.onkeydown=function(e){const t=document.activeElement;let n,a;if(k.classList.contains("popup-show"))switch(n=Array.prototype.slice.call(k.getElementsByTagName("BUTTON"),0),a=n.indexOf(t),e.key){case"ArrowUp":case"ArrowLeft":a>0&&n[n.indexOf(t)-1].focus();break;case"ArrowDown":case"ArrowRight":a<n.length-1&&n[n.indexOf(t)+1].focus();break;case"Escape":Te(k)}else if(B.classList.contains("popup-show"))switch(n=Array.prototype.slice.call(B.getElementsByTagName("BUTTON"),0),a=n.indexOf(t),e.key){case"ArrowUp":case"ArrowLeft":a>0&&n[n.indexOf(t)-1].focus();break;case"ArrowDown":case"ArrowRight":a<n.length-1&&n[n.indexOf(t)+1].focus();break;case"Escape":Te(B)}else if(T.classList.contains("popup-show"))switch(n=Array.prototype.slice.call(T.querySelectorAll("INPUT,A:not([style*='display: none;'])"),0),a=n.indexOf(t),e.key){case"ArrowUp":case"ArrowLeft":a>0&&(n[n.indexOf(t)-1].focus(),e.preventDefault());break;case"ArrowDown":case"ArrowRight":a<n.length-1&&(n[n.indexOf(t)+1].focus(),e.preventDefault());break;case"Space":case" ":case"Enter":a>=1&&t.click();break;case"Escape":Te(T)}else if(S.classList.contains("popup-show"))switch(n=Array.prototype.slice.call(S.querySelectorAll("BUTTON,INPUT:not(#b_image_input)"),0),a=n.indexOf(t),e.key){case"ArrowUp":case"ArrowLeft":a>0&&n[n.indexOf(t)-1].focus();break;case"ArrowDown":case"ArrowRight":a<n.length-1&&n[n.indexOf(t)+1].focus();break;case"Escape":Te(S)}else if(M.classList.contains("popup-show"))switch(n=Array.prototype.slice.call(M.getElementsByTagName("BUTTON"),0),a=n.indexOf(t),e.key){case"ArrowUp":case"ArrowLeft":a>0&&n[n.indexOf(t)-1].focus();break;case"ArrowDown":case"ArrowRight":a<n.length-1&&n[n.indexOf(t)+1].focus();break;case"Escape":Te(M)}else if(o("popupDialog").classList.contains("popup-show"))switch(n=Array.prototype.slice.call(o("popupDialog").getElementsByTagName("BUTTON"),0),a=n.indexOf(t),e.key){case"ArrowUp":case"ArrowLeft":a>0&&n[n.indexOf(t)-1].focus();break;case"ArrowDown":case"ArrowRight":a<n.length-1&&n[n.indexOf(t)+1].focus();break;case"Escape":ze()}else if(o("popupLeft").classList.contains("popup-show"))switch(n=Array.prototype.slice.call(o("popupLeft").getElementsByTagName("BUTTON"),0),a=n.indexOf(t),e.key){case"ArrowUp":case"ArrowLeft":a>0&&n[n.indexOf(t)-1].focus();break;case"ArrowDown":case"ArrowRight":a<n.length-1&&n[n.indexOf(t)+1].focus();break;case"Escape":ze()}else if(v.classList.contains("swipe-in"))switch(n=Array.prototype.slice.call(v.getElementsByTagName("CANVAS"),0),a=n.indexOf(t),e.key){case"ArrowLeft":a>0&&n[n.indexOf(t)-1].focus();break;case"ArrowRight":a<n.length-1&&n[n.indexOf(t)+1].focus();break;case"Space":case" ":case"Enter":case"ArrowDown":a>=0&&Ye(a);break;case"Escape":ze()}else switch(n=Array.prototype.slice.call(_.querySelectorAll("BUTTON:not([disabled])"),0),a=n.indexOf(t),e.key){case"ArrowUp":case"ArrowLeft":a>0&&n[n.indexOf(t)-1].focus();break;case"ArrowDown":case"ArrowRight":a<n.length-1&&n[n.indexOf(t)+1].focus()}},window.onload=function(){let e;if(Be&&null!==localStorage.getItem("s_sound")?D.checked="on"===localStorage.getItem("s_sound"):D.checked=!0,b=D.checked,Be&&null!==localStorage.getItem("s_image")&&(O.src=localStorage.getItem("s_image"),E=!0),Be&&null!==localStorage.getItem("s_name")&&(x.value=localStorage.getItem("s_name"),""!==localStorage.getItem("s_name").replace(/\s+/g,"")&&(I=!0)),Be&&null!==localStorage.getItem("s_country")){u=localStorage.getItem("s_country");let e=document.getElementsByClassName(u)[0];Q.innerHTML=e.innerHTML,Q.classList=e.classList}for(o("iInfo").addEventListener("click",(function(){Se(k)})),o("iInfoClose").addEventListener("click",(function(){Te(k)})),o("iStats").addEventListener("click",(function(){Se(B)})),o("iStatsClose").addEventListener("click",(function(){Te(B)})),o("iSettings").addEventListener("click",(function(){Se(S)})),o("iSettingsClose").addEventListener("click",(function(){b=D.checked,Be&&localStorage.setItem("s_sound",D.checked?"on":"off"),Te(S)})),o("iOnlineClose").addEventListener("click",(function(){Te(M)})),o("bt_country").addEventListener("click",(function(){Se(T)})),o("bt_play").addEventListener("click",(function(){L="2player",o("P1icon").src=E?O.src:"Images/player.svg",p=I?x.value:document.webL10n.get("lb_player1"),Ne(R),u&&R.classList.add(u.split(" ")[1]),Ne(C),h=document.webL10n.get("lb_player2"),o("P1name").innerHTML=p,o("P2name").innerHTML=h,o("P2icon").src="Images/player.svg",xe(),De(),_e=!1,_.classList.remove("swipe-out-right"),v.classList.remove("swipe-in-left"),_.classList.add("swipe-out"),v.classList.add("swipe-in")})),o("bt_online").addEventListener("click",(function(){Se(M),o("bt_online").disabled=!0,pe=io.connect("https://grrd.a2hosted.com:49152",{forceNew:!0}),pe.heartbeatTimeout=2e4,pe.on("connect",(function(){})),pe.on("startgame",(function(e){he=e,ue=0,fe=0,he.id!==we&&(f=E?O.src:null,pe.emit("usersend",{to:he.opponent,name:x.value,pic:f,country:u,win:le,loose:se}),we=he.id,_e=!1,null!==L&&(_.classList.remove("swipe-out"),v.classList.remove("swipe-in"),_.classList.add("swipe-out-right"),v.classList.add("swipe-in-left")),i=!1,Oe(),Le=0,j=0,be=[0,0],L="online",xe(),De(),"0"===he.role?(o("P1icon").src=E?O.src:"Images/player.svg",p=I?x.value:document.webL10n.get("lb_player1"),Ne(R),u&&R.classList.add(u.split(" ")[1]),Ne(C),o("P2icon").src="Images/online.svg",h=document.webL10n.get("bt_online")):(Ne(R),o("P1icon").src="Images/online.svg",p=document.webL10n.get("bt_online"),o("P2icon").src=E?O.src:"Images/player.svg",h=I?x.value:document.webL10n.get("lb_player1"),Ne(C),u&&C.classList.add(u.split(" ")[1])),o("P1name").innerHTML=p,o("P2name").innerHTML=h,_.classList.remove("swipe-out-right"),v.classList.remove("swipe-in-left"),_.classList.add("swipe-out"),v.classList.add("swipe-in"),Te(M))})),pe.on("playget",(function(e){0===e.round&&ve>6&&Ve(),ve===e.round&&Ie!==e.round&&(Ie=e.round,ke=!0,Ge(e.col))})),pe.on("userget",(function(e){ue=parseInt(e.win),fe=parseInt(e.loose),ie=Math.max(le,se,ue,fe,1),"0"===he.role?(null!==e.pic&&(o("P2icon").src=e.pic),e.name.length>0&&(h=e.name,o("P2name").innerHTML=h),Ne(C),e.country&&C.classList.add(e.country.split(" ")[1])):(null!==e.pic&&(o("P1icon").src=e.pic),e.name.length>0&&(p=e.name,o("P1name").innerHTML=p),Ne(R),e.country&&R.classList.add(e.country.split(" ")[1])),De()})),pe.on("quit",(function(){he.id!==ye&&"online"===L&&(ye=he.id,_e=!0,Se(o("popupLeft")))}))})),o("bt_easy").addEventListener("click",(function(){L="easy",qe()})),o("bt_med").addEventListener("click",(function(){L="medium",qe()})),o("bt_hard").addEventListener("click",(function(){L="hard",qe()})),Array.from(document.getElementsByClassName("back")).forEach((function(e){e.addEventListener("click",(function(){ze()}))})),o("again").addEventListener("click",(function(){ve>1&&Ve(),Te(o("popupDialog")),"2player"!==L&&"online"!==L&&1===j&&Ze()})),o("bt_img").addEventListener("click",(function(){o("b_image_input").click()})),o("bt_reset").addEventListener("click",(function(){Be&&(localStorage.removeItem("easy_start"),localStorage.removeItem("easy_win"),localStorage.removeItem("easy_loose"),localStorage.removeItem("easy_draw"),localStorage.removeItem("medium_start"),localStorage.removeItem("medium_win"),localStorage.removeItem("medium_loose"),localStorage.removeItem("medium_draw"),localStorage.removeItem("hard_start"),localStorage.removeItem("hard_win"),localStorage.removeItem("hard_loose"),localStorage.removeItem("hard_draw"),localStorage.removeItem("online_Start"),localStorage.removeItem("online_win"),localStorage.removeItem("online_loose"),localStorage.removeItem("online_draw"),localStorage.removeItem("online_left"),Pe())})),x.onchange=function(){var e;""!==(e=this.value).replace(/\s+/g,"")?(Be&&localStorage.setItem("s_name",e),I=!0):(Be&&localStorage.removeItem("s_name"),I=!1)},N.onchange=function(){et(this.value.toLowerCase())},N.addEventListener("keyup",(function(e){et(this.value.toLowerCase())})),e=0;e<l.length;e+=1)s[e]=document.getElementById(l[e]),r[e]=s[e].getContext("2d"),function(e){s[e].addEventListener("click",(function(){Ye(e)})),s[e].addEventListener("mouseover",(function(){je(e)})),s[e].addEventListener("mouseout",(function(){We(e)})),s[e].addEventListener("focus",(function(){je(e)})),s[e].addEventListener("blur",(function(){We(e)}))}(e);P.childNodes.forEach((function(e){e.addEventListener("click",(function(){u=this.className,localStorage.setItem("s_country",this.className),Q.innerHTML=this.innerHTML,Q.classList=this.classList,Te(T),N.value="",et("")})),e.tabIndex=0})),document.getElementById("b_image_input").addEventListener("change",$e,!1),Qe()},window.addEventListener("resize",(function(){Qe()})),document.webL10n.ready((function(){U=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null!==t&&t[1]}("lang"),a=!0,U&&U!==document.webL10n.getLanguage()&&(document.webL10n.setLanguage(U),a=!1)})),document.addEventListener("localized",(function(){a&&(document.documentElement.lang=document.webL10n.getLanguage().substr(0,2),document.querySelector("meta[name='description']").setAttribute("content",document.webL10n.get("lb_desc")),document.querySelector("link[rel='manifest']").href="Manifest/appmanifest_"+document.webL10n.getLanguage().substr(0,2)+".json",document.querySelector("link[rel='canonical']").href="https://grrd01.github.io/4inaRow/?lang="+document.webL10n.getLanguage().substr(0,2),Pe(),Array.from(P.getElementsByTagName("LI")).sort((e,t)=>e.textContent.localeCompare(t.textContent)).forEach(e=>P.appendChild(e))),a=!0}))}();